[toc]

# 引文

![编译流程图](https://github.com/Guoao-Sun/operating_system/blob/master/%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B%E5%9B%BE.png)
<p align="center">编译流程图</p>
如编译流程图所示，GCC编译器**读取源文件**并将其翻译成一个可执行文件的过程，可分为四个主要部分：
1. 预处理
2. 编译
3. 汇编
4. 链接
。

本文就四个编译部分分别展开阐述文本文件被翻译成机器可执行文件的过程。
> 文本文件：仅由ASCII字符组成的文件。
二进制文件：除文本文件之外的所有其他文件皆称为文本文件。


# 1. 预处理
在预处理过程由**预处理器CPP**如C预处理器，C Pre-Processor，间歇为CPP）负责，预处理器主要完成三部分工作：
1. 读取字符"#"开头的头文件的内容，如头文件、宏定义、条件编译指令；
2. 将头文件内容直接插入源文件中，此步的本质是字符替换；
3. 将扩展插入头文件内容的C程序文件输出为以`.c`为作为扩展名的新文本文件。

此外，预处理过程会保留[`#pragma`](http://www.chenkexiong.com/vc-pragma.html)编译指令，该指令的作用是设定编译器的状态，以及指示编译器完成特定的动作。

**预处理命令示例**
```bash
## 预编译后得到的依然是`.c`文本文件。
$ gcc -E source.c -o a.c
```

# 2. 编译
编译阶段，由**编译器CCL**负责将C程序从高级语言翻译成汇编语言(`.s`作为汇编文本文件扩展格式，如objdump输出的`.s`汇编文本文件)。
> 汇编语言具有非常重要的作用，它为不同高级语言的不同编译器提供了通用的低级输出语言。

因此，编译器主要负责完成：
1. 词法分析
2. 语法分析
3. 语义分析
4. 优化并生成汇编代码

**编译命令示例**
```bash
$ gcc -S source.c -o a.s
```

# 3. 汇编
汇编阶段，由**汇编器AS**负责将汇编语言翻译为机器语言（二进制）指令。然后汇编器将机器语言指令打包为**可重定位目标程序（relocatable object program）**，并输出至以`.o`为文件扩展名的二进制文件中（即是，汇编器的输入为汇编文本文件，输出是机器指令二进制文件）。

**汇编命令示例**
```bash
$ gcc -c source.c -o a.o
```

# 4. 链接
链接阶段，由**链接器LD**负责将源程序所依赖的文件（如标准库）以`.o`目标文件的形式与源文件汇编得到的`.o`目标文件合并。

什么是“源程序依赖的文件”？如源程序中用到了C标准库的`printf`函数，那么该标准库被源程序所依赖。同时我们可以使用`ldd`查看可执行程序的依赖库。

**链接命令示例**
```bash
$ gcc source.c -o a
```
